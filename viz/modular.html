<html>
<head>
    <meta charset="UTF-8">
    <title>Snowflakes Data Studio Scatter Plot Prototype</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://ajax.bam2x.net/libs/d3.box.js"></script>
    <script src="./lib/snowflake.js"></script>
</head>
<body>
<div id="canvas">
</div>
</body>
<script>
/**
 * Module Panel Source 
 */

(function (S,$) {

       d3.select("body").append("div").attr("class","panel").attr("id","")
	
        $("#source_option").on("change",
        function(d){
            if (this.value=="input") {
               $("#input_row").prop("hidden",false)
               $("#results_row").prop("hidden",true)
               $("#local_file_row").prop("hidden",true)
                getSrc()
            }
            else if (this.value=="results"){
                $("#input_row").prop("hidden",true)
                $("#results_row").prop("hidden",false)
                $("#local_file_row").prop("hidden",true)
                getSrc()
            }
            else if(this.value=="local_file") {
                $("#input_row").prop("hidden",true)
                $("#results_row").prop("hidden",true)
                $("#local_file_row").prop("hidden",false)
                
                getSrc()
                $("#body").removeClass("body_loading")
            }
        }
        )
         window.src_handle_sheet_index=function(data)
        {

            var s=""
            data.table.rows.forEach(function(d) {
                s+="<option value='"+d.c[1].v+"' timen='"+d.c[2].v+"'>"+d.c[0].v+"</option>";
            })
            $("#gsheet").html(s)
            
        }
        S.gsheet.query("select *","1KfB5nVwLB9B095l82oBA_L7Hg7keBcUHx4pp-sU3ONg","window.src_handle_sheet_index");
        
        
        $("#gsheet").on("change",function(d) {getSrc()});
         window.handle_sheet_index=function(data)
        {
            
            var s=""
            console.log(data);
            data.table.cols.forEach(function(d,i) {
                s+="<option value="+i+">"+d.label+"</option>";
            })
           
            $(".col_input").html(s)
            d3.selectAll(".loading").property("hidden",true);
            $("body").removeClass("body_loading")
            if($("#source_option").val()=="input" || $("#source_opition").val()=="local_file")
            {
            $("#xi").val(1)
            $("#yi").val(2)
            $("#zi").val(3)
            }
            else
            {
             $("#xi").val(2)
             $("#cx").val(1)
             $("#cy").val(4)
            $("#yi").val(3)
            $("#zi").val(1)
            $("#zi_type").val("category")
            }
            window.data=data;
            window.view();
            
        }

</html>
